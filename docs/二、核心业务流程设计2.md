#### 1. 成果物类型表（achievement_type）

存储系统管理员配置的成果物类型（论文、专利、软著、标准等），核心字段：

| 字段名           | 类型         | 说明                                |
| ---------------- | ------------ | ----------------------------------- |
| id               | bigint       | 主键，自增                          |
| type_code        | varchar(50)  | 类型编码（如 PAPER、PATENT），唯一  |
| type_name        | varchar(100) | 类型名称（如 “学术论文”“发明专利”） |
| description      | varchar(500) | 类型描述                            |
| config_json      | text         | 该类型的动态属性配置（JSON 格式）   |
| form_layout_json | text         | 存 formDesigner 的布局配置          |
| create_time      | datetime     | 创建时间                            |
| update_time      | datetime     | 更新时间                            |
| is_delete        | tinyint      | 逻辑删除（0 = 正常，1 = 删除）      |

**关键字段说明**：`config_json` 存储该类型的动态属性定义，示例（论文类型）：

json

```json
{
  "properties": [
    {
      "prop_code": "paper_title",
      "prop_name": "论文标题",
      "prop_type": "TEXT",       // 字段类型：TEXT/SELECT/NUMBER/DATE等
      "is_required": true,       // 是否必填
      "options": [],             // 下拉选项（SELECT类型用）
      "default_value": ""        // 默认值
    },
    {
      "prop_code": "journal_name",
      "prop_name": "期刊名称",
      "prop_type": "TEXT",
      "is_required": true,
      "options": [],
      "default_value": ""
    },
    {
      "prop_code": "paper_level",
      "prop_name": "论文级别",
      "prop_type": "SELECT",
      "is_required": true,
      "options": [
        {"label": "核心期刊", "value": "CORE"},
        {"label": "EI", "value": "EI"},
        {"label": "SCI", "value": "SCI"}
      ],
      "default_value": ""
    }
  ]
}
```

#### 2. 成果物主表（achievement_main）

存储所有类型成果物的**公共属性**（无需扩展的固定字段），核心字段：

| 字段名         | 类型         | 说明                                                     |
| -------------- | ------------ | -------------------------------------------------------- |
| id             | bigint       | 主键，自增                                               |
| type_id        | bigint       | 关联成果物类型表 id                                      |
| project_id     | bigint       | 关联项目id                                               |
| abstract       | String       | 摘要                                                     |
| title          | varchar(500) | 成果物名称（统一标题，便于检索）                         |
| creator_id     | bigint       | 创建人 ID（关联用户表）                                  |
| create_dept_id | bigint       | 创建部门 ID（关联部门表）                                |
| status         | varchar(20)  | 状态（待审核 / 审核中 / 审核通过 / 需要修改/已拒绝驳回） |
| create_time    | datetime     | 创建时间                                                 |
| update_time    | datetime     | 更新时间                                                 |
| is_delete      | tinyint      | 逻辑删除                                                 |



#### 3. 成果物动态属性表（achievement_dynamic_attr）

存储各类型成果物的**动态属性值**，采用 “键值对” 模式：

| 字段名         | 类型        | 说明                                 |
| -------------- | ----------- | ------------------------------------ |
| id             | bigint      | 主键，自增                           |
| achievement_id | bigint      | 关联成果物主表 id                    |
| prop_code      | varchar(50) | 属性编码（对应 type 表的 prop_code） |
| prop_value     | text        | 属性值（兼容文本、数字、日期等）     |
| create_time    | datetime    | 创建时间                             |
| update_time    | datetime    | 更新时间                             |

#### 4. 成果物附件表（achievement_attachment）

存储各类成果物的附件（论文 PDF、专利申请书等）：

| 字段名         | 类型         | 说明                        |
| -------------- | ------------ | --------------------------- |
| id             | bigint       | 主键，自增                  |
| achievement_id | bigint       | 关联成果物主表 id           |
| file_name      | varchar(200) | 文件名                      |
| file_path      | varchar(500) | 文件存储路径（或 OSS 地址） |
| file_size      | bigint       | 文件大小（字节）            |
| file_type      | varchar(50)  | 文件类型（pdf/doc/zip 等）  |
| upload_time    | datetime     | 上传时间                    |

### 二、核心业务流程设计

#### 1. 系统管理员新增成果物类型

- 前端提供 “成果物类型配置” 页面，管理员填写类型名称、编码、描述；
- 可视化配置该类型的动态属性（属性名称、编码、类型、是否必填、下拉选项等）；
- 后端将配置信息存入`achievement_type`表的`config_json`字段，无需修改表结构。

#### 2. 普通用户新增成果物

- 用户选择成果物类型（如 “发明专利”）；
- 前端根据该类型的`config_json`动态渲染表单（文本框、下拉框、日期选择器等）；
- 用户填写表单后，后端：
  - 先将公共属性存入`achievement_main`表，生成`achievement_id`；
  - 再将动态属性以 “键值对” 形式批量存入`achievement_dynamic_attr`表；
  - 附件存入`achievement_attachment`表。







### 学术论文（最常见的成果物类型）

json例子

```json
{
  "properties": [
    {
      "prop_code": "paper_title",       // 属性编码（后端存储/查询用，唯一）
      "prop_name": "论文标题",           // 属性名称（前端展示用，用户易懂）
      "prop_type": "TEXT",              // 属性类型：文本框
      "is_required": true,              // 是否必填：是
      "options": [],                    // 下拉选项：无（TEXT类型不需要）
      "default_value": "",              // 默认值：空
      "sort": 1,                        // 展示顺序：第1个
      "placeholder": "请输入论文全称"    // 输入框提示语（前端用）
    },
    {
      "prop_code": "journal_name",
      "prop_name": "期刊名称",
      "prop_type": "TEXT",
      "is_required": true,
      "options": [],
      "default_value": "",
      "sort": 2,
      "placeholder": "如：中国科学:信息科学"
    },
    {
      "prop_code": "paper_level",
      "prop_name": "论文级别",
      "prop_type": "SELECT",            // 属性类型：下拉选择框
      "is_required": true,
      "options": [                      // 下拉选项（label展示，value存储）
        {"label": "普通期刊", "value": "ORDINARY"},
        {"label": "核心期刊", "value": "CORE"},
        {"label": "EI检索", "value": "EI"},
        {"label": "SCI检索", "value": "SCI"},
        {"label": "SSCI检索", "value": "SSCI"}
      ],
      "default_value": "",
      "sort": 3,
      "placeholder": ""
    },
    {
      "prop_code": "publish_date",
      "prop_name": "发表时间",
      "prop_type": "DATE",              // 属性类型：日期选择器
      "is_required": true,
      "options": [],
      "default_value": "",
      "sort": 4,
      "placeholder": "选择论文正式发表的日期"
    },
    {
      "prop_code": "author_list",
      "prop_name": "作者列表",
      "prop_type": "TEXT",
      "is_required": true,
      "options": [],
      "default_value": "",
      "sort": 5,
      "placeholder": "格式：张三,李四,王五（通讯作者标注*，如：张三*,李四）"
    },
    {
      "prop_code": "page_range",
      "prop_name": "页码范围",
      "prop_type": "TEXT",
      "is_required": false,             // 是否必填：否（非核心属性）
      "options": [],
      "default_value": "",
      "sort": 6,
      "placeholder": "如：120-135"
    },
    {
      "prop_code": "fund_project",
      "prop_name": "基金项目",
      "prop_type": "MULTI_SELECT",      // 属性类型：多选框
      "is_required": false,
      "options": [
        {"label": "国家自然科学基金", "value": "NSFC"},
        {"label": "省级科技攻关项目", "value": "PROVINCIAL"},
        {"label": "校企合作项目", "value": "COOPERATION"}
      ],
      "default_value": "",
      "sort": 7,
      "placeholder": "可多选"
    }
  ],
  "form_rules": {                       // 扩展：表单级规则（可选）
    "max_attachments": 3,               // 最多上传3个附件（论文PDF、录用通知等）
    "attachment_types": ["pdf", "doc", "docx"]  // 仅允许上传这些格式的附件
  }
}
```





作为系统管理员，要实现**可视化自定义成果物类型 + 动态表单 + 数据落地到数据库**，核心是搭建一套「类型配置后台 + 动态表单渲染引擎 + 数据存储适配层」的闭环方案。以下是可落地的完整解决方案，包含操作流程、技术选型、核心代码示例和数据库映射逻辑：

### 一、整体方案架构（管理员视角）

```plaintext
管理员操作端（前端配置页） → 配置数据（JSON） → 后端存储（achievement_type表） → 
↓                                                                                   ↑
用户使用端（前端表单页） ← 配置解析（JSON） ← 后端读取（缓存+数据库）                用户提交数据 → 后端拆分存储（主表+动态属性表）
```

### 二、核心解决方案：可视化配置 + 自动映射数据库

#### 步骤 1：前端搭建「成果物类型配置页面」（管理员操作）

推荐基于 **Vue3 + Element Plus/Arco Design** 或 **React + Ant Design** 开发可视化配置页，核心功能模块：

| 配置模块           | 功能说明                                                     |
| ------------------ | ------------------------------------------------------------ |
| 基础信息配置       | 填写类型名称、编码、描述（对应 achievement_type 表的 type_name/type_code/description） |
| 动态属性配置       | 可视化添加 / 编辑 / 删除属性（对应 config_json 的 properties 数组） |
| 表单规则配置       | 设置附件数量 / 格式限制（对应 config_json 的 form_rules）    |
| 预览 / 保存 / 发布 | 预览表单效果，保存配置到数据库，发布后普通用户可使用         |

##### 前端配置页核心交互示例（Vue3 伪代码）

```vue
<template>
  <!-- 1. 基础信息配置 -->
  <el-form :model="typeForm" label-width="120px">
    <el-form-item label="类型编码" prop="typeCode">
      <el-input v-model="typeForm.typeCode" placeholder="如：SOFT_COPYRIGHT" />
    </el-form-item>
    <el-form-item label="类型名称" prop="typeName">
      <el-input v-model="typeForm.typeName" placeholder="如：软件著作权" />
    </el-form-item>
    <el-form-item label="类型描述" prop="description">
      <el-input v-model="typeForm.description" type="textarea" />
    </el-form-item>
  </el-form>

  <!-- 2. 动态属性配置（核心） -->
  <div class="attr-config">
    <el-button type="primary" @click="addNewAttr">新增属性</el-button>
    <!-- 属性列表 -->
    <el-table :data="attrList" border>
      <el-table-column label="属性编码" prop="propCode" />
      <el-table-column label="属性名称" prop="propName" />
      <el-table-column label="属性类型">
        <template #default="scope">
          <el-select v-model="scope.row.propType">
            <el-option label="文本框" value="TEXT" />
            <el-option label="下拉框" value="SELECT" />
            <el-option label="日期选择器" value="DATE" />
            <el-option label="数字框" value="NUMBER" />
          </el-select>
        </template>
      </el-table-column>
      <el-table-column label="是否必填">
        <template #default="scope">
          <el-switch v-model="scope.row.isRequired" />
        </template>
      </el-table-column>
      <el-table-column label="下拉选项" v-if="scope.row.propType === 'SELECT'">
        <template #default="scope">
          <el-input v-model="scope.row.options" placeholder="格式：标签1|值1,标签2|值2" />
        </template>
      </el-table-column>
      <el-table-column label="操作">
        <template #default="scope">
          <el-button type="text" @click="editAttr(scope.row)">编辑</el-button>
          <el-button type="text" danger @click="deleteAttr(scope.row)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>

  <!-- 3. 表单规则配置 -->
  <el-form :model="formRules" label-width="120px">
    <el-form-item label="最大附件数">
      <el-input-number v-model="formRules.maxAttachments" min="0" />
    </el-form-item>
    <el-form-item label="允许附件格式">
      <el-select v-model="formRules.attachmentTypes" multiple>
        <el-option label="PDF" value="pdf" />
        <el-option label="Word" value="doc" />
        <el-option label="压缩包" value="zip" />
      </el-select>
    </el-form-item>
  </el-form>

  <!-- 4. 操作按钮 -->
  <el-button type="primary" @click="previewForm">预览表单</el-button>
  <el-button type="success" @click="saveTypeConfig">保存配置</el-button>
</template>

<script setup>
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { saveAchievementType } from '@/api/achievement' // 后端接口

// 类型基础信息
const typeForm = ref({
  typeCode: '',
  typeName: '',
  description: ''
})

// 动态属性列表（对应config_json的properties）
const attrList = ref([
  // 初始空模板，新增属性时push新对象
  // { propCode: '', propName: '', propType: 'TEXT', isRequired: false, options: [], sort: 1 }
])

// 表单规则（对应config_json的form_rules）
const formRules = ref({
  maxAttachments: 3,
  attachmentTypes: ['pdf']
})

// 新增属性
const addNewAttr = () => {
  attrList.value.push({
    propCode: '',
    propName: '',
    propType: 'TEXT',
    isRequired: false,
    options: [],
    default_value: '',
    sort: attrList.value.length + 1,
    placeholder: ''
  })
}

// 保存配置（核心：组装config_json并提交后端）
const saveTypeConfig = async () => {
  // 1. 组装config_json
  const configJson = {
    properties: attrList.value.map(attr => ({
      prop_code: attr.propCode,
      prop_name: attr.propName,
      prop_type: attr.propType,
      is_required: attr.isRequired,
      options: attr.propType === 'SELECT' 
        ? attr.options.split(',').map(item => {
            const [label, value] = item.split('|')
            return { label, value }
          }) 
        : [],
      default_value: attr.default_value,
      sort: attr.sort,
      placeholder: attr.placeholder
    })),
    form_rules: formRules.value
  }

  // 2. 提交后端（参数对应achievement_type表字段）
  const res = await saveAchievementType({
    type_code: typeForm.value.typeCode,
    type_name: typeForm.value.typeName,
    description: typeForm.value.description,
    config_json: JSON.stringify(configJson) // 转为JSON字符串存储
  })

  if (res.code === 200) {
    ElMessage.success('成果物类型配置成功！')
  }
}
</script>
```

#### 步骤 2：后端接收配置并存储到数据库

##### 核心接口（Java/Spring Boot 示例）

```java
@RestController
@RequestMapping("/achievement/type")
public class AchievementTypeController {

    @Autowired
    private AchievementTypeService achievementTypeService;

    // 保存成果物类型配置
    @PostMapping("/save")
    public ResultVO saveType(@RequestBody AchievementTypeDTO typeDTO) {
        // 1. 校验类型编码唯一性
        boolean exists = achievementTypeService.existsByTypeCode(typeDTO.getTypeCode());
        if (exists) {
            return ResultVO.error("类型编码已存在！");
        }

        // 2. 组装实体类（映射到achievement_type表）
        AchievementType type = new AchievementType();
        type.setTypeCode(typeDTO.getTypeCode());
        type.setTypeName(typeDTO.getTypeName());
        type.setDescription(typeDTO.getDescription());
        type.setConfigJson(typeDTO.getConfigJson()); // 直接存储JSON字符串
        type.setCreateTime(new Date());
        type.setUpdateTime(new Date());
        type.setIsDelete(0);

        // 3. 保存到数据库
        achievementTypeService.save(type);
        return ResultVO.success("配置成功！");
    }

    // 其他接口：查询类型列表、修改配置、删除类型等
}
```

##### 数据库映射逻辑

| 前端配置项          | 后端参数    | achievement_type 表字段 | 存储形式            |
| ------------------- | ----------- | ----------------------- | ------------------- |
| 类型编码            | typeCode    | type_code               | VARCHAR (50) 唯一   |
| 类型名称            | typeName    | type_name               | VARCHAR(100)        |
| 类型描述            | description | description             | VARCHAR(500)        |
| 动态属性 + 表单规则 | configJson  | config_json             | TEXT（JSON 字符串） |

#### 步骤 3：普通用户使用自定义类型提交数据（自动映射到主表 + 动态属性表）

##### 前端渲染动态表单（基于管理员配置的 config_json）

```vue
<template>
  <!-- 选择成果物类型 -->
  <el-form-item label="成果物类型">
    <el-select v-model="selectedTypeId" @change="loadFormConfig">
      <el-option 
        v-for="type in typeList" 
        :key="type.id" 
        :label="type.typeName" 
        :value="type.id"
      />
    </el-select>
  </el-form-item>

  <!-- 动态渲染表单 -->
  <el-form :model="dynamicForm" v-if="formConfig">
    <el-form-item 
      v-for="prop in formConfig.properties" 
      :key="prop.prop_code"
      :label="prop.prop_name"
      :prop="prop.prop_code"
      :rules="[{ required: prop.is_required, message: '请填写' + prop.prop_name }]"
    >
      <!-- 文本框 -->
      <el-input 
        v-if="prop.prop_type === 'TEXT'" 
        v-model="dynamicForm[prop.prop_code]"
        :placeholder="prop.placeholder"
      />
      <!-- 下拉框 -->
      <el-select 
        v-else-if="prop.prop_type === 'SELECT'" 
        v-model="dynamicForm[prop.prop_code]"
      >
        <el-option 
          v-for="opt in prop.options" 
          :key="opt.value" 
          :label="opt.label" 
          :value="opt.value"
        />
      </el-select>
      <!-- 日期选择器 -->
      <el-date-picker 
        v-else-if="prop.prop_type === 'DATE'" 
        v-model="dynamicForm[prop.prop_code]"
        format="YYYY-MM-DD"
      />
      <!-- 数字框 -->
      <el-input-number 
        v-else-if="prop.prop_type === 'NUMBER'" 
        v-model="dynamicForm[prop.prop_code]"
      />
    </el-form-item>

    <!-- 附件上传 -->
    <el-form-item label="附件上传">
      <el-upload
        :file-list="fileList"
        :accept="formConfig.form_rules.attachmentTypes.join(',')"
        :limit="formConfig.form_rules.maxAttachments"
      >
        <el-button type="primary">点击上传</el-button>
      </el-upload>
    </el-form-item>

    <el-button type="primary" @click="submitAchievement">提交</el-button>
  </el-form>
</template>

<script setup>
import { ref, reactive } from 'vue'
import { getTypeConfig } from '@/api/achievement'
import { submitAchievement } from '@/api/achievement'

const selectedTypeId = ref('') // 选中的成果物类型ID
const formConfig = ref(null)   // 加载的config_json配置
const dynamicForm = reactive({}) // 动态表单数据
const fileList = ref([])       // 附件列表

// 加载选中类型的表单配置
const loadFormConfig = async () => {
  const res = await getTypeConfig(selectedTypeId.value)
  formConfig.value = JSON.parse(res.data.configJson) // 解析JSON字符串
  // 初始化默认值
  formConfig.value.properties.forEach(prop => {
    dynamicForm[prop.prop_code] = prop.default_value
  })
}

// 提交成果物数据
const submitAchievement = async () => {
  // 1. 组装提交参数
  const params = {
    typeId: selectedTypeId.value, // 关联成果物类型ID
    title: dynamicForm.title || '', // 公共属性（主表）
    creatorId: '当前用户ID',
    createDeptId: '当前部门ID',
    dynamicAttrs: Object.entries(dynamicForm).map(([propCode, propValue]) => ({
      propCode,
      propValue
    })), // 动态属性（键值对）
    attachments: fileList.value.map(file => ({
      fileName: file.name,
      filePath: file.url,
      fileSize: file.size,
      fileType: file.type.split('/')[1]
    }))
  }

  // 2. 提交后端
  const res = await submitAchievement(params)
  if (res.code === 200) {
    ElMessage.success('提交成功！')
  }
}
</script>
```

##### 后端拆分存储到主表 + 动态属性表（Java 示例）

```java
@Service
public class AchievementService {

    @Autowired
    private AchievementMainMapper mainMapper;
    @Autowired
    private AchievementDynamicAttrMapper attrMapper;
    @Autowired
    private AchievementAttachmentMapper attachmentMapper;

    @Transactional // 事务保证数据一致性
    public void saveAchievement(AchievementSubmitDTO dto) {
        // 1. 保存主表（achievement_main）
        AchievementMain main = new AchievementMain();
        main.setTypeId(dto.getTypeId());
        main.setTitle(dto.getTitle());
        main.setCreatorId(dto.getCreatorId());
        main.setCreateDeptId(dto.getCreateDeptId());
        main.setStatus("DRAFT"); // 草稿状态
        main.setCreateTime(new Date());
        main.setUpdateTime(new Date());
        main.setIsDelete(0);
        mainMapper.insert(main);
        Long achievementId = main.getId(); // 获取主表ID

        // 2. 保存动态属性（achievement_dynamic_attr）
        if (dto.getDynamicAttrs() != null && !dto.getDynamicAttrs().isEmpty()) {
            List<AchievementDynamicAttr> attrList = dto.getDynamicAttrs().stream().map(attrDTO -> {
                AchievementDynamicAttr attr = new AchievementDynamicAttr();
                attr.setAchievementId(achievementId);
                attr.setPropCode(attrDTO.getPropCode());
                attr.setPropValue(attrDTO.getPropValue());
                attr.setCreateTime(new Date());
                attr.setUpdateTime(new Date());
                return attr;
            }).collect(Collectors.toList());
            attrMapper.batchInsert(attrList); // 批量插入
        }

        // 3. 保存附件（achievement_attachment）
        if (dto.getAttachments() != null && !dto.getAttachments().isEmpty()) {
            List<AchievementAttachment> attachmentList = dto.getAttachments().stream().map(attachDTO -> {
                AchievementAttachment attachment = new AchievementAttachment();
                attachment.setAchievementId(achievementId);
                attachment.setFileName(attachDTO.getFileName());
                attachment.setFilePath(attachDTO.getFilePath());
                attachment.setFileSize(attachDTO.getFileSize());
                attachment.setFileType(attachDTO.getFileType());
                attachment.setUploadTime(new Date());
                return attachment;
            }).collect(Collectors.toList());
            attachmentMapper.batchInsert(attachmentList);
        }
    }
}
```

##### 最终数据库映射关系

| 数据类型 | 存储表                   | 核心映射逻辑                                                 |
| -------- | ------------------------ | ------------------------------------------------------------ |
| 公共属性 | achievement_main         | type_id 关联成果物类型 ID，存储所有类型共有的字段（标题、创建人、状态等） |
| 动态属性 | achievement_dynamic_attr | achievement_id 关联主表 ID，prop_code 对应 config_json 的属性编码，prop_value 存值 |
| 附件     | achievement_attachment   | achievement_id 关联主表 ID，存储文件相关信息                 |

### 三、推荐的技术选型（降低开发成本）

| 技术层     | 推荐选型                                                     |
| ---------- | ------------------------------------------------------------ |
| 前端       | Vue3 + Element Plus（或 React + Ant Design）+ 动态表单组件（如 FormRender） |
| 后端       | Spring Boot + MyBatis-Plus（批量插入 / 查询）+ Redis（缓存 config_json） |
| 数据库     | MySQL（基础表）+ Redis（缓存）+ OSS（附件存储，如阿里云 OSS / 腾讯云 COS） |
| 可视化配置 | 基于 JSON Schema 的表单设计器（如 FormMaking、JsonForm）     |