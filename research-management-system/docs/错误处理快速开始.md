# é”™è¯¯å¤„ç†ç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹

## ğŸš€ 5åˆ†é’Ÿä¸Šæ‰‹

### 1. æœ€ç®€å•çš„åˆ—è¡¨é¡µé¢

```vue
<template>
  <div>
    <el-table :data="list" v-loading="loading">
      <el-table-column prop="title" label="æ ‡é¢˜" />
    </el-table>
    
    <el-pagination
      :current-page="page"
      :total="total"
      @current-change="handlePageChange"
    />
  </div>
</template>

<script setup lang="ts">
import { useList } from '@/composables/useErrorHandler'
import { getResultList } from '@/api/result'

// ä¸€è¡Œä»£ç æå®šåˆ—è¡¨åŠ è½½ + åˆ†é¡µ + é”™è¯¯å¤„ç†
const { loading, list, total, page, handlePageChange } = useList(
  getResultList, 
  { immediate: true }
)
</script>
```

### 2. æœ€ç®€å•çš„è¡¨å•æäº¤

```vue
<template>
  <el-form ref="formRef" :model="form">
    <el-form-item label="æ ‡é¢˜" prop="title">
      <el-input v-model="form.title" />
    </el-form-item>
    
    <el-button :loading="submitting" @click="handleSubmit">
      æäº¤
    </el-button>
  </el-form>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { useRouter } from 'vue-router'
import { useFormSubmit } from '@/composables/useErrorHandler'
import { createResult } from '@/api/result'

const router = useRouter()
const formRef = ref()
const form = reactive({ title: '' })

// ä¸€è¡Œä»£ç æå®šè¡¨å•éªŒè¯ + æäº¤ + é”™è¯¯å¤„ç† + æˆåŠŸè·³è½¬
const { submitting, submit } = useFormSubmit(createResult, {
  validate: () => formRef.value.validate(),
  successMessage: 'åˆ›å»ºæˆåŠŸ',
  onSuccess: () => router.push('/results')
})

const handleSubmit = () => submit(form)
</script>
```

### 3. æœ€ç®€å•çš„åˆ é™¤æ“ä½œ

```vue
<template>
  <el-button 
    type="danger"
    :loading="deleting"
    @click="handleDelete(row.id)"
  >
    åˆ é™¤
  </el-button>
</template>

<script setup lang="ts">
import { useDelete } from '@/composables/useErrorHandler'
import { deleteResult } from '@/api/result'

// ä¸€è¡Œä»£ç æå®šç¡®è®¤å¼¹çª— + åˆ é™¤ + é”™è¯¯å¤„ç† + åˆ·æ–°åˆ—è¡¨
const { deleting, confirmDelete } = useDelete(deleteResult, {
  onSuccess: () => refresh()
})

const handleDelete = (id: string) => confirmDelete(id)
</script>
```

### 4. æœ€ç®€å•çš„å¼‚æ­¥æ“ä½œ

```vue
<template>
  <el-button 
    :loading="executing"
    @click="handlePublish(resultId)"
  >
    å‘å¸ƒ
  </el-button>
</template>

<script setup lang="ts">
import { useAsyncAction } from '@/composables/useErrorHandler'
import { publishResult } from '@/api/result'

// ä¸€è¡Œä»£ç æå®šå¼‚æ­¥æ“ä½œ + é”™è¯¯å¤„ç† + æˆåŠŸæç¤º
const { executing, execute } = useAsyncAction(publishResult, {
  successMessage: 'å‘å¸ƒæˆåŠŸ'
})

const handlePublish = (id: string) => execute(id)
</script>
```

---

## ğŸ“¦ å®Œæ•´ç¤ºä¾‹

### ä¸€ä¸ªå®Œæ•´çš„ CRUD é¡µé¢

```vue
<template>
  <div>
    <!-- æœç´¢è¡¨å• -->
    <el-form inline>
      <el-form-item label="å…³é”®è¯">
        <el-input v-model="keyword" @change="reset" />
      </el-form-item>
    </el-form>

    <!-- è¡¨æ ¼ -->
    <el-table :data="list" v-loading="loading">
      <el-table-column prop="title" label="æ ‡é¢˜" />
      <el-table-column prop="status" label="çŠ¶æ€" />
      <el-table-column label="æ“ä½œ" width="200">
        <template #default="{ row }">
          <el-button size="small" @click="handleView(row.id)">
            æŸ¥çœ‹
          </el-button>
          <el-button 
            size="small" 
            type="danger"
            :loading="deleting"
            @click="handleDelete(row.id)"
          >
            åˆ é™¤
          </el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- åˆ†é¡µ -->
    <el-pagination
      :current-page="page"
      :page-size="pageSize"
      :total="total"
      @current-change="handlePageChange"
      @size-change="handleSizeChange"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { useList, useDelete } from '@/composables/useErrorHandler'
import { getResultList, deleteResult } from '@/api/result'

const router = useRouter()
const keyword = ref('')

// åˆ—è¡¨ç®¡ç†
const {
  loading,
  list,
  total,
  page,
  pageSize,
  fetch,
  reset,
  handlePageChange,
  handleSizeChange
} = useList(
  (params) => getResultList({ ...params, keyword: keyword.value }),
  { immediate: true }
)

// åˆ é™¤æ“ä½œ
const { deleting, confirmDelete } = useDelete(deleteResult, {
  confirmMessage: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæˆæœå—?',
  successMessage: 'åˆ é™¤æˆåŠŸ',
  onSuccess: () => fetch()
})

const handleDelete = (id: string) => confirmDelete(id)
const handleView = (id: string) => router.push(`/results/${id}`)
</script>
```

---

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

### Hook è‡ªåŠ¨å¤„ç†ä»€ä¹ˆ?

æ‰€æœ‰ Hook éƒ½ä¼šè‡ªåŠ¨å¤„ç†:
- âœ… Loading çŠ¶æ€ç®¡ç†
- âœ… é”™è¯¯æ•è·å’Œæç¤º
- âœ… é”™è¯¯æ—¥å¿—è®°å½•
- âœ… æˆåŠŸæ¶ˆæ¯æç¤º (å¯é€‰)

ä½ åªéœ€è¦:
- ä¼ å…¥ API å‡½æ•°
- å¤„ç†æˆåŠŸå›è°ƒ (å¯é€‰)

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä»€ä¹ˆ Hook?

| åœºæ™¯ | Hook | è¯´æ˜ |
|------|------|------|
| åˆ—è¡¨åŠ è½½ | `useList` | è‡ªåŠ¨å¤„ç†åˆ†é¡µã€åˆ·æ–° |
| è¡¨å•æäº¤ | `useFormSubmit` | è‡ªåŠ¨å¤„ç†éªŒè¯ã€æäº¤ |
| åˆ é™¤æ“ä½œ | `useDelete` | è‡ªåŠ¨å¤„ç†ç¡®è®¤ã€åˆ é™¤ |
| æ™®é€šå¼‚æ­¥ | `useAsyncAction` | é€šç”¨å¼‚æ­¥æ“ä½œ |
| æ™®é€šè¯·æ±‚ | `useRequest` | é€šç”¨æ•°æ®è¯·æ±‚ |

---

## ğŸ¯ æœ€ä½³å®è·µ

### âœ… æ¨è

```typescript
// ä½¿ç”¨ Hook
const { loading, execute } = useRequest(fetchData)
```

### âŒ ä¸æ¨è

```typescript
// æ‰‹åŠ¨ try-catch
const loading = ref(false)
try {
  loading.value = true
  await fetchData()
} catch (error) {
  ElMessage.error(error.message)
} finally {
  loading.value = false
}
```

---

## ğŸ”— æ›´å¤šèµ„æº

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](./é”™è¯¯å¤„ç†ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md)
- [é”™è¯¯å¤„ç†æ¼”ç¤ºé¡µé¢](../src/views/ErrorDemo.vue)
- [æ”¹è¿›æ€»ç»“](./é”™è¯¯å¤„ç†ç³»ç»Ÿæ”¹è¿›æ€»ç»“.md)

---

## ğŸ†˜ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•ç¦ç”¨è‡ªåŠ¨é”™è¯¯æç¤º?**
```typescript
const { execute } = useRequest(fetchData, {
  showErrorMessage: false  // ç¦ç”¨é”™è¯¯æç¤º
})
```

**Q: å¦‚ä½•è‡ªå®šä¹‰é”™è¯¯å¤„ç†?**
```typescript
const { execute } = useRequest(fetchData, {
  onError: (error) => {
    // è‡ªå®šä¹‰é”™è¯¯å¤„ç†
    console.log('é”™è¯¯:', error)
  }
})
```

**Q: å¦‚ä½•æŸ¥çœ‹é”™è¯¯æ—¥å¿—?**
```typescript
import { errorLogger } from '@/utils/errorHandler'

const logs = errorLogger.getLogs()
console.log('é”™è¯¯æ—¥å¿—:', logs)
```

---

å¼€å§‹ä½¿ç”¨é”™è¯¯å¤„ç†ç³»ç»Ÿ,è®©ä½ çš„ä»£ç æ›´ç®€æ´ã€æ›´å¯é ! ğŸš€
